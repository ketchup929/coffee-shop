const coffeeMenu = {
  "Cappuccino": [
    {
      "Name": "Classic Cappuccino",
      "Image": "https://i.pinimg.com/originals/41/4f/f9/414ff93ac84e212b5c5517653dc44f96.png?nii=t",
      "Price": "$3.56",
      "Description": "Perfect balance of espresso, milk and milk foam."
    },
    {
      "Name": "Coconut Milk Cappuccino",
      "Image": "https://avatars.mds.yandex.net/i?id=52ccae99d655dd7862165f02e54a767c_l-3710093-images-thumbs&n=13",
      "Price": "$4.22",
      "Description": "Lactose-free option with a light tropical aftertaste."
    },
    {
      "Name": "Vanilla Cappuccino",
      "Image": "https://i.pinimg.com/736x/3a/6d/7e/3a6d7ee7f98fb9665824587376a41994.jpg",
      "Price": "$3.89",
      "Description": "With natural vanilla syrup."
    },
    {
      "Name": "Chocolate Cappuccino (Mochaccino)",
      "Image": "https://i.pinimg.com/736x/90/88/26/908826e8cfa9094b3ca73144c82c782f.jpg",
      "Price": "$4.11",
      "Description": "With dark chocolate or cocoa."
    },
    {
      "Name": "Cinnamon & Cardamom Cappuccino",
      "Image": "https://i.pinimg.com/736x/3e/97/cf/3e97cfb2c35bfbd53c3bc9a345217e53.jpg",
      "Price": "$3.78",
      "Description": "Warming drink with spicy notes."
    },
    {
      "Name": "Cappuccino Freddo (Iced)",
      "Image": "https://avatars.mds.yandex.net/i?id=e03ecd0c825cb4410744c82052398721f9cdbcca-5883235-images-thumbs&n=13",
      "Price": "$4.00",
      "Description": "Cold version with ice and airy foam."
    }
  ],
  "Latte": [
    {
      "Name": "Classic Latte",
      "Image": "https://avatars.mds.yandex.net/i?id=8c904b3a91bf067b8d76201a27cacd9a095fa561-5880141-images-thumbs&n=13",
      "Price": "$3.89",
      "Description": "Gentle coffee with lots of frothed milk."
    },
    {
      "Name": "Oat Milk Latte",
      "Image": "https://avatars.mds.yandex.net/i?id=f8dfabbb69698f4aa8396dc46caef641289a90b377a43ee1-5897487-images-thumbs&n=13",
      "Price": "$4.22",
      "Description": "Plant-based alternative with creamy texture."
    },
    {
      "Name": "Caramel Latte",
      "Image": "https://avatars.mds.yandex.net/i?id=0ed825842be770d2d1f4ce473d6d59766511b229-5300806-images-thumbs&n=13",
      "Price": "$4.33",
      "Description": "Sweet drink with caramel syrup and foam art."
    },
    {
      "Name": "Lavender Latte",
      "Image": "https://avatars.mds.yandex.net/i?id=ca91062cb66e91f829d0a8200f05d7d6283290f6-5240131-images-thumbs&n=13",
      "Price": "$4.11",
      "Description": "With floral lavender notes, calming and aromatic."
    },
    {
      "Name": "Matcha Latte",
      "Image": "https://avatars.mds.yandex.net/i?id=217e83cb3aee804b278e5a2493b7ff4bd8d5d69a-15586103-images-thumbs&n=13",
      "Price": "$4.44",
      "Description": "Based on green matcha tea, caffeine-free."
    },
    {
      "Name": "Salted Caramel Latte",
      "Image": "https://avatars.mds.yandex.net/i?id=962f1769184a75f0d65c8e4522e2a47a9381096c-5241083-images-thumbs&n=13",
      "Price": "$4.33",
      "Description": "Perfect combination of sweet caramel and sea salt."
    }
  ],
  "Americano": [
    {
      "Name": "Classic Americano",
      "Image": "https://avatars.mds.yandex.net/i?id=2e95e1d00563dc463228ffb0f623dc6ac793ae90-5859525-images-thumbs&n=13",
      "Price": "$2.78",
      "Description": "Espresso with added hot water, strong and rich."
    },
    {
      "Name": "Lungo",
      "Image": "https://img.kavosdraugas.lt/bb3268c6-285b-4e23-96b9-f8cd78cf7460/1000x1000/dg-lungo-megapack-cupjpg.jpg",
      "Price": "$2.89",
      "Description": "Longer espresso extraction than classic."
    },
    {
      "Name": "Americano with Lemon",
      "Image": "https://avatars.mds.yandex.net/i?id=8ef5d950793cf9150646b252591c7cd34392faeb-4011753-images-thumbs&n=13",
      "Price": "$3.00",
      "Description": "Refreshing option with a slice of lemon."
    },
    {
      "Name": "Iced Americano",
      "Image": "https://avatars.mds.yandex.net/i?id=fc008ba79d9e466d52b4fe3b216c7eb29262f0a8-10918338-images-thumbs&n=13",
      "Price": "$3.11",
      "Description": "Cold, invigorating, served with ice."
    },
    {
      "Name": "Americano with Tonic",
      "Image": "https://avatars.mds.yandex.net/i?id=070cfa35843575cde4f10f65d5ac94e5d242fbdc-5433983-images-thumbs&n=13",
      "Price": "$3.33",
      "Description": "Trendy option with chilled tonic water."
    },
    {
      "Name": "Americano Misto",
      "Image": "https://avatars.mds.yandex.net/i?id=c0eb98234db52b4b354a11fe1d550942b0374fc0-5279811-images-thumbs&n=13",
      "Price": "$3.22",
      "Description": "A smooth blend of Americano and steamed milk."
    }
  ],
  "Espresso": [
    {
      "Name": "Espresso",
      "Image": "https://avatars.mds.yandex.net/i?id=4195d247913691d3697a4b57ae14cd2f046a9632-4809555-images-thumbs&n=13",
      "Price": "$2.22",
      "Description": "Classic 30ml portion of strong coffee."
    },
    {
      "Name": "Doppio (Double Espresso)",
      "Image": "https://avatars.mds.yandex.net/i?id=cec2096e3438cbf43e2640fd604fe9920ed18381-5544858-images-thumbs&n=13",
      "Price": "$3.11",
      "Description": "Double portion for true connoisseurs."
    },
    {
      "Name": "Ristretto",
      "Image": "https://avatars.mds.yandex.net/i?id=724caf3d17da97c674ad786bf773edf4d4c71cc7-5875897-images-thumbs&n=13",
      "Price": "$2.44",
      "Description": "More concentrated and sweeter than espresso."
    },
    {
      "Name": "Espresso Con Panna",
      "Image": "https://avatars.mds.yandex.net/i?id=e2fbc1de90778477f4930766b2eab79b7fce44c2-4442360-images-thumbs&n=13",
      "Price": "$2.89",
      "Description": "Espresso topped with whipped cream."
    },
    {
      "Name": "Espresso Romano",
      "Image": "https://i.pinimg.com/736x/bb/36/45/bb36453d9573dd3872ac8bcebbe0b2a6.jpg",
      "Price": "$2.56",
      "Description": "With a slice or zest of lemon."
    },
    {
      "Name": "Espresso Macchiato",
      "Image": "https://avatars.mds.yandex.net/i?id=a00e435960f611146d57adee750946dd225792c6d228b44b-10153545-images-thumbs&n=13",
      "Price": "$2.67",
      "Description": "Espresso with a small cap of milk foam."
    }
  ],
  "Flat White": [
    {
      "Name": "Classic Flat White",
      "Image": "https://avatars.mds.yandex.net/i?id=f188b9b079151feb0de50bca79e25888d06c9ebd-5247511-images-thumbs&n=13",
      "Price": "$3.78",
      "Description": "Double ristretto with microfoam, creamy and rich."
    },
    {
      "Name": "Almond Milk Flat White",
      "Image": "https://avatars.mds.yandex.net/i?id=66ab0ad556771c09a80f1ec2cf8d768fd1448a04-12486332-images-thumbs&n=13",
      "Price": "$4.11",
      "Description": "With nutty notes and velvety texture."
    },
    {
      "Name": "Ginger-Honey Flat White",
      "Image": "https://avatars.mds.yandex.net/i?id=1822c6ee3b84bc5835b1da23229254f79cdc530f-4592636-images-thumbs&n=13",
      "Price": "$4.22",
      "Description": "With ginger syrup and honey."
    },
    {
      "Name": "Salted Caramel Flat White",
      "Image": "https://i.pinimg.com/736x/3e/0c/5c/3e0c5c8d9c10762c81909ce87867a1bc.jpg",
      "Price": "$4.22",
      "Description": "Balance of coffee bitterness, sweetness and saltiness."
    },
    {
      "Name": "Cocoa Flat White",
      "Image": "https://avatars.mds.yandex.net/i?id=2a00000179feb02238f164da5424d1898baf-3521501-images-thumbs&n=13",
      "Price": "$4.00",
      "Description": "With a sprinkle of dark cocoa on delicate foam."
    },
    {
      "Name": "Flat White Freddo (Iced)",
      "Image": "https://avatars.mds.yandex.net/i?id=0bc8f6b900a996cfb5ec0447e39c33181e80c5c5-9855103-images-thumbs&n=13",
      "Price": "$4.00",
      "Description": "Cold version, blended with ice until smooth."
    }
  ]
};

let orders = JSON.parse(localStorage.getItem('coffeeOrders')) || [];
let allCoffeeItems = [];

const initializeAllCoffeeItems = () => {
  allCoffeeItems = [];
  Object.keys(coffeeMenu).forEach(coffeeType => {
    coffeeMenu[coffeeType].forEach(item => {
      allCoffeeItems.push({
        ...item,
        type: coffeeType
      });
    });
  });
};

initializeAllCoffeeItems();

const filterCardsBySearch = (searchTerm) => {
  if (!searchTerm || searchTerm.trim() === '') {
    const activeButton = document.querySelector('.slide button.active');
    if (activeButton) {
      showCards(activeButton.textContent);
    }
    return;
  }
  
  const searchTermLower = searchTerm.toLowerCase().trim();
  
  const filteredItems = allCoffeeItems.filter(item => {
    return (
      item.Name.toLowerCase().includes(searchTermLower) ||
      item.Description.toLowerCase().includes(searchTermLower) ||
      item.type.toLowerCase().includes(searchTermLower)
    );
  });
  
  showFilteredCards(filteredItems, searchTerm);
};

const showFilteredCards = (filteredItems, searchTerm) => {
  cards.innerHTML = "";
  
  if (filteredItems.length === 0) {
    cards.innerHTML = `
      <div class="no-results">
        <p>No coffee found for "${searchTerm}"</p>
      </div>
    `;
    return;
  }
  
  filteredItems.forEach(item => {
    cards.innerHTML += `
      <div class="card" data-coffee='${JSON.stringify(item)}'>
        <div class="card-image"><img src="${item.Image || 'img/coffee-placeholder.png'}" alt="${item.Name}"></div>
        <div class="card-content">
          <h3>${item.Name}</h3>
          <div class="card-footer">
            <span class="price">${item.Price}</span>
            <button class="add-btn">+</button>
          </div>
        </div>
      </div>`;
  });

  document.querySelectorAll('.card').forEach(card => {
    const coffeeData = JSON.parse(card.getAttribute('data-coffee'));
    
    card.addEventListener('click', (e) => {
      if (!e.target.classList.contains('add-btn')) {
        showCoffeeDetail(coffeeData);
      }
    });
    
    const addBtn = card.querySelector('.add-btn');
    addBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      addToOrder(coffeeData);
    });
  });
};

document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.querySelector('.browse');
  
  searchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value;
    filterCardsBySearch(searchTerm);
  });
});

const saveOrdersToStorage = () => {
  localStorage.setItem('coffeeOrders', JSON.stringify(orders));
};

const parsePrice = (priceString) => {
  return parseFloat(priceString.replace('$', '').trim());
};

const formatPrice = (amount) => {
  return `$${amount.toFixed(2)}`;
};

const calculatePrice = (basePrice, size) => {
  const priceMap = {
    'short': 0.9,
    'tall': 1.0,    
    'grande': 1.15, 
    'venti': 1.3    
  };
  
  const numericPrice = parsePrice(basePrice);
  return numericPrice * (priceMap[size] || 1);
};

const calculateTotal = () => {
  let subtotal = 0;
  
  orders.forEach(order => {
    const price = parsePrice(order.price);
    subtotal += price * order.quantity;
  });
  
  const discount = subtotal * 0.1;
  const total = subtotal - discount;
  
  return { 
    subtotal: formatPrice(subtotal), 
    discount: formatPrice(discount), 
    total: formatPrice(total) 
  };
};

let cards =  document.querySelector(".cards");
const orderStatusLink = document.querySelector(".ORDER-STATUS a");
const counterElement = document.querySelector('.counter');

const showCards = (coffeeType = "Cappuccino") => {
  cards.innerHTML = "";
  coffeeMenu[coffeeType].forEach(item => {
    cards.innerHTML += `
      <div class="card" data-coffee='${JSON.stringify(item)}'>
        <div class="card-image"><img src="${item.Image || 'img/coffee-placeholder.png'}" alt="${item.Name}"></div>
        <div class="card-content">
          <h3>${item.Name}</h3>
          <div class="card-footer">
            <span class="price">${item.Price}</span>
            <button class="add-btn">+</button>
          </div>
        </div>
      </div>`;
  });

  document.querySelectorAll('.card').forEach(card => {
    const coffeeData = JSON.parse(card.getAttribute('data-coffee'));
    
    card.addEventListener('click', (e) => {
      if (!e.target.classList.contains('add-btn')) {
        showCoffeeDetail(coffeeData);
      }
    });
    
    const addBtn = card.querySelector('.add-btn');
    addBtn.addEventListener('click', (e) => {
      e.stopPropagation(); 
      addToOrder(coffeeData);
    });
  });
};

const addToOrder = (orderItem) => {
  const coffeeName = orderItem.name;
  const coffeePrice = orderItem.price;
  const orderQuantity = orderItem.quantity || 1;
  
  const existingOrder = orders.find(order => 
    order.name === coffeeName && 
    order.price === coffeePrice &&
    order.size === orderItem.size &&
    JSON.stringify(order.extras) === JSON.stringify(orderItem.extras) &&
    order.milk === orderItem.milk
  );
  
  if (existingOrder) {
    existingOrder.quantity += orderQuantity;
    existingOrder.totalPrice = formatPrice(parsePrice(existingOrder.price) * existingOrder.quantity);
  }
  else {
    orders.push({
      name: coffeeName,
      price: coffeePrice,
      quantity: orderQuantity,
      image: orderItem.image,
      size: orderItem.size,
      extras: orderItem.extras || [],
      milk: orderItem.milk || 'regular',
      totalPrice: formatPrice(parsePrice(coffeePrice) * orderQuantity)
    });
  }
  
  saveOrdersToStorage();
  updateOrderCounter();

  if (!document.querySelector('.statusPage').classList.contains('hidden')) {
    displayOrdersInStatus();
  }
};

const displayOrdersInStatus = () => {
  const statusContainer = document.querySelector('.imgAndInfoStatus');
  
  if (orders.length === 0) {
    statusContainer.innerHTML = '<p>No items in order yet.</p>';
    return;
  }
  
  const { subtotal, discount, total } = calculateTotal();
  
  let html = '<h3>Your Order:</h3>';
  orders.forEach(order => {
    const itemTotal = formatPrice(parsePrice(order.price) * order.quantity);
    html += `
      <div class="order-item">
        <p><strong>${order.name}</strong> x${order.quantity} - ${itemTotal}</p>
      </div>
    `;
  });
  
  html += `
    <div class="order-summary">
      <div class="price-row">
        <span>Subtotal:</span>
        <span class="price-value">${subtotal}</span>
      </div>
      <div class="price-row discount">
        <span>First Order Discount (10%):</span>
        <span class="price-value">-${discount}</span>
      </div>
      <div class="price-row total">
        <span>Total:</span>
        <span class="price-value">${total}</span>
      </div>
      <button class="submit-order-btn" id="submitOrderBtn">SUBMIT ORDER</button>
    </div>
  `;
  
  statusContainer.innerHTML = html;
  
  document.getElementById('submitOrderBtn')?.addEventListener('click', () => {
    submitOrder();
  });
};

const submitOrder = () => {
  if (orders.length === 0) {
    return;
  }
  
  orders = [];
  saveOrdersToStorage();
  updateOrderCounter();
  displayOrdersInStatus();
  
  document.querySelector('.overlay').classList.add('hidden');
  document.querySelector('.statusPage').classList.add('hidden');
};

const updateOrderCounter = () => {
  let totalItems = 0;
  for (const order of orders) {
    totalItems += order.quantity;
  }
  
  if (counterElement) {
    counterElement.innerHTML = totalItems > 0 ? 
      `<span class="order-count">${totalItems}</span>` : 
      '';
  }
  
  const ringRing = document.querySelector('.ring-ring');
  if (ringRing) {
    if (totalItems > 0) {
      ringRing.style.fill = '#CD4126';
    } else {
      ringRing.style.fill = '#483431';
    }
  }
  
};

updateOrderCounter();

const showCoffeeDetail = (coffee) => {
  document.querySelector('.menuPage').classList.add('hidden');
  document.querySelector('.coffeeInfoPage').classList.remove('hidden');
  
  const basePrice = parsePrice(coffee.Price);
  let quantity = 1;
  
  const imgAndInfo = document.querySelector('.imgAndInfo');
  imgAndInfo.innerHTML = `
    <img src="${coffee.Image || 'img/coffee-placeholder.png'}" alt="${coffee.Name}">
    <div class="infoAboutCoffee">
      <p class="nameOfCoffee">${coffee.Name}</p>
      <p class="descriptionOfCoffee">${coffee.Description}</p>

      <span>SIZE</span>
      <div class="size">
  <button class="size-btn" data-size="short" data-price="${(basePrice * 0.9).toFixed(2)}">
    <div class="size-content">
      <svg width="28" height="65" viewBox="0 0 58 65" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12.8889 65H45.1111C45.8865 65.0001 46.6359 64.7182 47.2219 64.206C47.8078 63.6938 48.191 62.9856 48.3011 62.2115L54.3492 19.5H58V13H53.5469L47.9918 1.79725C47.725 1.25701 47.314 0.802582 46.8051 0.485074C46.2962 0.167565 45.7095 -0.000424452 45.1111 8.05387e-07H12.8889C11.6677 8.05387e-07 10.5528 0.695501 10.005 1.79725L4.45311 13H0V19.5H3.65078L9.69889 62.2115C9.809 62.9856 10.1922 63.6938 10.7781 64.206C11.3641 64.7182 12.1135 65.0001 12.8889 65ZM46.458 29.25H11.542L10.1597 19.5H47.8371L46.458 29.25ZM15.6826 58.5L14.3002 48.75H43.6966L42.3142 58.5H15.6826ZM14.8802 6.5H43.1198L46.342 13H11.658L14.8802 6.5Z" fill="#AC8F64"/>
      </svg>
      <span>Short</span>
    </div>
  </button>
  
  <button class="size-btn" data-size="tall" data-price="${basePrice.toFixed(2)}">
    <div class="size-content">
      <svg width="38" height="65" viewBox="0 0 58 65" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12.8889 65H45.1111C45.8865 65.0001 46.6359 64.7182 47.2219 64.206C47.8078 63.6938 48.191 62.9856 48.3011 62.2115L54.3492 19.5H58V13H53.5469L47.9918 1.79725C47.725 1.25701 47.314 0.802582 46.8051 0.485074C46.2962 0.167565 45.7095 -0.000424452 45.1111 8.05387e-07H12.8889C11.6677 8.05387e-07 10.5528 0.695501 10.005 1.79725L4.45311 13H0V19.5H3.65078L9.69889 62.2115C9.809 62.9856 10.1922 63.6938 10.7781 64.206C11.3641 64.7182 12.1135 65.0001 12.8889 65ZM46.458 29.25H11.542L10.1597 19.5H47.8371L46.458 29.25ZM15.6826 58.5L14.3002 48.75H43.6966L42.3142 58.5H15.6826ZM14.8802 6.5H43.1198L46.342 13H11.658L14.8802 6.5Z" fill="#AC8F64"/>
      </svg>
      <span>Tall</span>
    </div>
  </button>
  
  <button class="size-btn" data-size="grande" data-price="${(basePrice * 1.15).toFixed(2)}">
    <div class="size-content">
      <svg width="48" height="65" viewBox="0 0 58 65" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12.8889 65H45.1111C45.8865 65.0001 46.6359 64.7182 47.2219 64.206C47.8078 63.6938 48.191 62.9856 48.3011 62.2115L54.3492 19.5H58V13H53.5469L47.9918 1.79725C47.725 1.25701 47.314 0.802582 46.8051 0.485074C46.2962 0.167565 45.7095 -0.000424452 45.1111 8.05387e-07H12.8889C11.6677 8.05387e-07 10.5528 0.695501 10.005 1.79725L4.45311 13H0V19.5H3.65078L9.69889 62.2115C9.809 62.9856 10.1922 63.6938 10.7781 64.206C11.3641 64.7182 12.1135 65.0001 12.8889 65ZM46.458 29.25H11.542L10.1597 19.5H47.8371L46.458 29.25ZM15.6826 58.5L14.3002 48.75H43.6966L42.3142 58.5H15.6826ZM14.8802 6.5H43.1198L46.342 13H11.658L14.8802 6.5Z" fill="#AC8F64"/>
      </svg>
      <span>Grande</span>
    </div>
  </button>
  
  <button class="size-btn" data-size="venti" data-price="${(basePrice * 1.3).toFixed(2)}">
    <div class="size-content">
      <svg width="58" height="65" viewBox="0 0 58 65" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12.8889 65H45.1111C45.8865 65.0001 46.6359 64.7182 47.2219 64.206C47.8078 63.6938 48.191 62.9856 48.3011 62.2115L54.3492 19.5H58V13H53.5469L47.9918 1.79725C47.725 1.25701 47.314 0.802582 46.8051 0.485074C46.2962 0.167565 45.7095 -0.000424452 45.1111 8.05387e-07H12.8889C11.6677 8.05387e-07 10.5528 0.695501 10.005 1.79725L4.45311 13H0V19.5H3.65078L9.69889 62.2115C9.809 62.9856 10.1922 63.6938 10.7781 64.206C11.3641 64.7182 12.1135 65.0001 12.8889 65ZM46.458 29.25H11.542L10.1597 19.5H47.8371L46.458 29.25ZM15.6826 58.5L14.3002 48.75H43.6966L42.3142 58.5H15.6826ZM14.8802 6.5H43.1198L46.342 13H11.658L14.8802 6.5Z" fill="#AC8F64"/>
      </svg>
      <span>Venti</span>
    </div>
  </button>
</div>


      <span>EXTRA</span>
      <div class="extra">
        <button class="extra-btn" data-extra="sugar" data-price="0.33">SUGAR (+$0.33)</button>
        <button class="extra-btn" data-extra="milk" data-price="0.44">MILK (+$0.44)</button>
      </div>

      <span>MILK TYPE</span>
      <div class="milk">
        <button class="milk-btn" data-milk="oat" data-price="0.56">OAT MILK (+$0.56)</button>
        <button class="milk-btn" data-milk="soy" data-price="0.44">SOY MILK (+$0.44)</button>
        <button class="milk-btn" data-milk="almond" data-price="0.67">ALMOND MILK (+$0.67)</button>
      </div>

      <div class="quantity-controls">
    <button class="quantity-btn" id="decreaseQuantity">-</button>
    <span class="quantity-display" id="quantityDisplay">1</span>
    <button class="quantity-btn" id="increaseQuantity">+</button>
</div>

      <div class="price-display">
        <p>Price: <span id="currentPrice">${basePrice.toFixed(2)}</span>$</p>
      </div>

      <button class="placeOrderBtn" id="placeOrderBtn">PLACE ORDER</button>
    </div>
  `;

  const quantityDisplay = document.getElementById('quantityDisplay');
  const decreaseBtn = document.getElementById('decreaseQuantity');
  const increaseBtn = document.getElementById('increaseQuantity');

  const tallBtn = imgAndInfo.querySelector('.size-btn[data-size="tall"]');
  if (tallBtn) {
    tallBtn.classList.add('active');
  }

  const updatePrice = () => {
    let price = basePrice;
    
    const selectedSize = document.querySelector('.size-btn.active');
    if (selectedSize) {
      price = parseFloat(selectedSize.getAttribute('data-price'));
    }
    
    document.querySelectorAll('.extra-btn.active').forEach(extra => {
      price += parseFloat(extra.getAttribute('data-price'));
    });
    
    const selectedMilk = document.querySelector('.milk-btn.active');
    if (selectedMilk) {
      price += parseFloat(selectedMilk.getAttribute('data-price'));
    }

    const currentQuantity = parseInt(quantityDisplay.textContent) || 1;
    const totalPrice = price * currentQuantity;
    
    document.getElementById('currentPrice').textContent = price.toFixed(2);
    document.getElementById('placeOrderBtn').setAttribute('data-final-price', price.toFixed(2));
  };

  const updateQuantityDisplay = () => {
    quantityDisplay.textContent = quantity;
    updatePrice();
  };

  decreaseBtn?.addEventListener('click', () => {
    if (quantity > 1) {
      quantity--;
      updateQuantityDisplay();
    }
  });

  increaseBtn?.addEventListener('click', () => {
    quantity++;
    updateQuantityDisplay();
  });

  document.querySelectorAll('.size-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      updatePrice();
    });
  });

  document.querySelectorAll('.extra-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      this.classList.toggle('active');
      updatePrice();
    });
  });

  document.querySelectorAll('.milk-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.milk-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      updatePrice();
    });
  });

  orderStatusLink?.addEventListener('click', (e) => {
  e.preventDefault();
  showOrderStatus();
  });

  document.getElementById('placeOrderBtn')?.addEventListener('click', () => {
    const finalPrice = parseFloat(document.getElementById('placeOrderBtn').getAttribute('data-final-price')) || basePrice;
    const selectedSize = document.querySelector('.size-btn.active')?.getAttribute('data-size') || 'tall';
    
    const quantity = parseInt(document.getElementById('quantityDisplay').textContent) || 1;
  
    const selectedExtras = [];
    document.querySelectorAll('.extra-btn.active').forEach(extra => {
      selectedExtras.push(extra.getAttribute('data-extra'));
    });
    
    const selectedMilk = document.querySelector('.milk-btn.active')?.getAttribute('data-milk') || 'regular';

    const orderItem = {
      name: coffee.Name,
      price: formatPrice(finalPrice),
      quantity: quantity,
      image: coffee.Image,
      size: selectedSize,
      extras: selectedExtras,
      milk: selectedMilk,
      totalPrice: formatPrice(finalPrice * quantity)
    };
    
    addToOrder(orderItem);
    showOrderStatus();
  });

  document.querySelector('.coffeeInfoPage .ORDER-STATUS a')?.addEventListener('click', (e) => {
    e.preventDefault();
    showOrderStatus();
  });

  updateQuantityDisplay();
};

function showOrderStatus() {
  document.querySelector('.overlay').classList.remove('hidden');
  document.querySelector('.statusPage').classList.remove('hidden');
  
  let totalItems = 0;
  for (const order of orders) {
    totalItems += order.quantity;
  }
  
  displayOrdersInStatus();
}

document.getElementById('backToMenuFromCoffee')?.addEventListener('click', (e) => {
  e.preventDefault();
  document.querySelector('.coffeeInfoPage').classList.add('hidden');
  document.querySelector('.menuPage').classList.remove('hidden');
});

document.getElementById('backToMenuFromStatus')?.addEventListener('click', (e) => {
  e.preventDefault();
  document.querySelector('.overlay').classList.add('hidden');
  document.querySelector('.statusPage').classList.add('hidden');
});

document.querySelector('.overlay').addEventListener('click', () => {
  document.querySelector('.overlay').classList.add('hidden');
  document.querySelector('.statusPage').classList.add('hidden');
});

orderStatusLink?.addEventListener('click', (e) => {
  e.preventDefault();
  showOrderStatus();
});

document.querySelector('.picture')?.addEventListener('click', () => {
  showOrderStatus();
});

const slideButtons = document.querySelectorAll('.slide button');
const upButton = document.querySelector('.up');
const downButton = document.querySelector('.down');
let currentActiveIndex = 0;

const activateButton = (index) => {
  slideButtons.forEach(b => b.classList.remove('active'));
  slideButtons[index].classList.add('active');
  
  const coffeeType = slideButtons[index].textContent;
  showCards(coffeeType);
  currentActiveIndex = index;
};

slideButtons.forEach((btn, index) => {
  btn.addEventListener('click', () => {
    activateButton(index);
  });
});

upButton.addEventListener('click', () => {
  let newIndex = currentActiveIndex - 1;
  if (newIndex < 0) newIndex = slideButtons.length - 1;
  activateButton(newIndex);
});

downButton.addEventListener('click', () => {
  let newIndex = currentActiveIndex + 1;
  if (newIndex >= slideButtons.length) newIndex = 0;
  activateButton(newIndex);
});

document.getElementById('hideStatusBtn')?.addEventListener('click', (e) => {
  e.preventDefault();
  document.querySelector('.overlay').classList.add('hidden');
  document.querySelector('.statusPage').classList.add('hidden');
});

activateButton(0);